#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <sys/shm.h>
#include <sys/stat.h>
#include <sys/mman.h>
#include <sys/types.h>
#include <string.h>

int main(int argc, char *argv[])
{
	const char *name = "COLLATZ";
	const int SIZE = 4096;

	pid_t pid;
	int shm_fd;
	void *ptr;
	int n;
	char str[128];

	if (argc == 1) {
		fprintf(stderr,"Usage: ./a.out <starting value>\n");
		return -1;
	}

	n = atoi(argv[1]); /* å¾å‘½ä»¤å??–å?è¦è?ç®—ç??ƒæ??²è?æ¸¬æ•¸?—ç¬¬ä¸€?‹æ•¸å­?*/
	
	shm_fd = shm_open(name, O_CREAT | O_RDWR, 0666);/* å»ºç?ä¸€?‹å…±?¨è??¶é??©ä»¶ */ 
	ftruncate(shm_fd,SIZE); /* è¨­å??±ç”¨è¨˜æ†¶é«”ç‰©ä»¶ç?å¤§å? */
	ptr = mmap(0,SIZE, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	 /* ?±ç”¨è¨˜æ†¶é«”ç‰©ä»¶æ?å°„è‡³è¡Œç?ä½å?ç©ºé? */
	const int* message1 ;
	
	int num[128],i=0;
	num[i++]=n;
	int k;
	while(1){
		
		if(n==1)
			break;
		else if(n%2==0){
			n/=2;
			num[i++]=n;
		}
		else{
			n*=3;
			n+=1;
			num[i++]=n;
		}
	}
	k=i;
	message1 = num;

	
	for (i =0; i < k; i++)
	{
		sprintf(ptr,"%d",*(message1+i));
		ptr += sizeof(*(message1));
	}
	
	

	return 0;
	
}